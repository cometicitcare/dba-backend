# Vihara Data API - Frontend Developer Guide

## Overview
This document provides the complete API specification for creating Vihara (temple) records, including the new **resident_bhikkhus** feature.

## Endpoint
```
POST /api/v1/vihara-data/manage
```

## Authentication
Required: Bearer token in Authorization header
```
Authorization: Bearer {your_access_token}
```

---

## Request Structure

### Action-Based Request Format
```json
{
  "action": "CREATE",
  "payload": {
    "data": {
      // Fields listed below
    }
  }
}
```

---

## Field Mapping: Frontend ↔ Backend

### Basic Temple Information

| Frontend Field (camelCase) | Backend Field (snake_case) | Type | Required | Max Length | Description |
|---------------------------|---------------------------|------|----------|------------|-------------|
| `temple_name` | `vh_vname` | string | No | 200 | Name of the temple |
| `temple_address` | `vh_addrs` | string | No | 200 | Physical address |
| `telephone_number` | `vh_mobile` | string | **Yes** | 10 | Must be exactly 10 digits |
| `whatsapp_number` | `vh_whtapp` | string | **Yes** | 10 | Must be exactly 10 digits |
| `email_address` | `vh_email` | string | **Yes** | - | Valid email format |
| `province` | `vh_province` | string | No | 100 | Province name |
| `district` | `vh_district` | string | No | 100 | District name |
| `divisional_secretariat` | `vh_divisional_secretariat` | string | No | 100 | Divisional secretariat |
| `pradeshya_sabha` | `vh_pradeshya_sabha` | string | No | 100 | Pradeshya sabha name |
| `grama_niladhari_division` | `vh_gndiv` | string | **Yes** | 10 | GN division code |
| `nikaya` | `vh_nikaya` | string | No | 50 | Nikaya name |
| `parshawaya` | `vh_parshawa` | string | **Yes** | 10 | Parshawa code |
| `viharadhipathi_name` | `vh_viharadhipathi_name` | string | No | 200 | Chief monk's name |
| `period_established` | `vh_period_established` | string | No | 100 | Year or period established |
| `buildings_description` | `vh_buildings_description` | string | No | 1000 | Description of buildings |
| `dayaka_families_count` | `vh_dayaka_families_count` | string | No | 50 | Number of dayaka families |
| `kulangana_committee` | `vh_kulangana_committee` | string | No | 500 | Committee details |
| `dayaka_sabha` | `vh_dayaka_sabha` | string | No | 500 | Dayaka Sabha details |
| `temple_working_committee` | `vh_temple_working_committee` | string | No | 500 | Working committee details |
| `other_associations` | `vh_other_associations` | string | No | 500 | Other associations |

### Temple Owned Land (Array)

**Field Name:** `temple_owned_land`

Each land object contains:

| Frontend Field (camelCase) | Type | Required | Description |
|---------------------------|------|----------|-------------|
| `serialNumber` | number | **Yes** | Sequential number (1, 2, 3...) |
| `landName` | string | No | Name/description of land |
| `village` | string | No | Village name |
| `district` | string | No | District name |
| `extent` | string | No | Land extent (e.g., "2 acres 1 rood") |
| `cultivationDescription` | string | No | Description of cultivation |
| `ownershipNature` | string | No | Nature of ownership |
| `deedNumber` | string | No | Deed number |
| `titleRegistrationNumber` | string | No | Title registration number |
| `taxDetails` | string | No | Tax details |
| `landOccupants` | string | No | Current occupants |

**Note:** Do NOT include `id` field when creating - it's auto-generated by the backend.

### Resident Bhikkhus (Array) ⭐ NEW

**Field Name:** `resident_bhikkhus`

Each resident bhikkhu object contains:

| Frontend Field (camelCase) | Type | Required | Description |
|---------------------------|------|----------|-------------|
| `serialNumber` | number | **Yes** | Sequential number (1, 2, 3...) |
| `bhikkhuName` | string | No | Full name of the bhikkhu |
| `registrationNumber` | string | No | Bhikkhu registration number |
| `occupationEducation` | string | No | Occupation and education details |

**Note:** Do NOT include `id` field when creating - it's auto-generated by the backend.

### Certification & Inspection

| Frontend Field (camelCase) | Backend Field (snake_case) | Type | Required | Description |
|---------------------------|---------------------------|------|----------|-------------|
| `land_info_certified` | `vh_land_info_certified` | boolean | No | Land info certified |
| `resident_bhikkhus_certified` | `vh_resident_bhikkhus_certified` | boolean | No | Resident bhikkhus info certified |
| `inspection_report` | `vh_inspection_report` | string | No | Inspection report details |
| `inspection_code` | `vh_inspection_code` | string | No | Inspection code |
| `grama_niladhari_division_ownership` | `vh_grama_niladhari_division_ownership` | string | No | Ownership details |

### Deeds & Recommendations

| Frontend Field (camelCase) | Backend Field (snake_case) | Type | Required | Description |
|---------------------------|---------------------------|------|----------|-------------|
| `sanghika_donation_deed` | `vh_sanghika_donation_deed` | boolean | No | Has Sanghika donation deed |
| `government_donation_deed` | `vh_government_donation_deed` | boolean | No | Has government donation deed |
| `government_donation_deed_in_progress` | `vh_government_donation_deed_in_progress` | boolean | No | Deed in progress |
| `authority_consent_attached` | `vh_authority_consent_attached` | boolean | No | Authority consent attached |
| `recommend_new_center` | `vh_recommend_new_center` | boolean | No | Recommend as new center |
| `recommend_registered_temple` | `vh_recommend_registered_temple` | boolean | No | Recommend as registered temple |

### Annex 2 Fields

| Frontend Field (camelCase) | Backend Field (snake_case) | Type | Required | Description |
|---------------------------|---------------------------|------|----------|-------------|
| `annex2_recommend_construction` | `vh_annex2_recommend_construction` | boolean | No | Recommend construction |
| `annex2_land_ownership_docs` | `vh_annex2_land_ownership_docs` | boolean | No | Land ownership docs |
| `annex2_chief_incumbent_letter` | `vh_annex2_chief_incumbent_letter` | boolean | No | Chief incumbent letter |
| `annex2_coordinator_recommendation` | `vh_annex2_coordinator_recommendation` | boolean | No | Coordinator recommendation |
| `annex2_divisional_secretary_recommendation` | `vh_annex2_divisional_secretary_recommendation` | boolean | No | Divisional secretary recommendation |
| `annex2_approval_construction` | `vh_annex2_approval_construction` | boolean | No | Approval for construction |
| `annex2_referral_resubmission` | `vh_annex2_referral_resubmission` | boolean | No | Referral for resubmission |

---

## Complete Example Request

```json
{
  "action": "CREATE",
  "payload": {
    "data": {
      "temple_name": "Sri Dharmarama Viharaya",
      "temple_address": "123 Temple Road, Gampaha",
      "telephone_number": "0771234567",
      "whatsapp_number": "0771234567",
      "email_address": "dharmarama@temple.lk",
      "province": "Western",
      "district": "Gampaha",
      "divisional_secretariat": "Gampaha",
      "pradeshya_sabha": "Gampaha Municipal Council",
      "grama_niladhari_division": "1-2-24-070",
      "nikaya": "Siyam Nikaya",
      "parshawaya": "PR005",
      "viharadhipathi_name": "Ven. Dharmasena Thero",
      "period_established": "1950",
      "buildings_description": "Main shrine hall (Buddha statue), Dhamma hall, Meditation hall, Living quarters for 3 monks",
      "dayaka_families_count": "50",
      "kulangana_committee": "10 member committee, meets monthly",
      "dayaka_sabha": "Active dayaka sabha with 50 members",
      "temple_working_committee": "5 member working committee",
      "other_associations": "Sunday school, Library, Elderly care program",
      
      "temple_owned_land": [
        {
          "serialNumber": 1,
          "landName": "Main Temple Land",
          "village": "Gampaha Town",
          "district": "Gampaha",
          "extent": "2 acres 1 rood 15 perches",
          "cultivationDescription": "Temple buildings, garden, and parking area",
          "ownershipNature": "Temple owned - Sanghika deed",
          "deedNumber": "D-12345/2020",
          "titleRegistrationNumber": "TR-2020-GH-001",
          "taxDetails": "Exempt from property tax as religious institution",
          "landOccupants": "Resident monks (3) and temple caretaker"
        },
        {
          "serialNumber": 2,
          "landName": "Back Garden",
          "village": "Gampaha Town",
          "district": "Gampaha",
          "extent": "50 perches",
          "cultivationDescription": "Vegetable garden and fruit trees",
          "ownershipNature": "Temple owned",
          "deedNumber": "D-12346/2021"
        }
      ],
      
      "land_info_certified": true,
      
      "resident_bhikkhus": [
        {
          "serialNumber": 1,
          "bhikkhuName": "Ven. Dharmasena Thero",
          "registrationNumber": "BH2025000001",
          "occupationEducation": "Chief Monk, Viharadhipathi, BA in Buddhist Studies, Dhamma Teacher"
        },
        {
          "serialNumber": 2,
          "bhikkhuName": "Ven. Sumana Thero",
          "registrationNumber": "BH2025000002",
          "occupationEducation": "Assistant Monk, Sunday School Teacher, Diploma in Pali"
        },
        {
          "serialNumber": 3,
          "bhikkhuName": "Ven. Ananda Thero",
          "registrationNumber": "BH2025000003",
          "occupationEducation": "Novice Monk, Student of Buddhist Philosophy"
        }
      ],
      
      "resident_bhikkhus_certified": true,
      "inspection_report": "Inspection conducted on 2025-11-15. All facilities in good condition. Adequate living quarters for resident monks. Water and electricity available.",
      "inspection_code": "INS-2025-GH-001",
      "grama_niladhari_division_ownership": "Temple",
      
      "sanghika_donation_deed": true,
      "government_donation_deed": false,
      "government_donation_deed_in_progress": false,
      "authority_consent_attached": true,
      "recommend_new_center": false,
      "recommend_registered_temple": true,
      
      "annex2_recommend_construction": false,
      "annex2_land_ownership_docs": true,
      "annex2_chief_incumbent_letter": true,
      "annex2_coordinator_recommendation": true,
      "annex2_divisional_secretary_recommendation": true,
      "annex2_approval_construction": false,
      "annex2_referral_resubmission": false
    }
  }
}
```

---

## Success Response

**Status Code:** `200 OK`

```json
{
  "status": "success",
  "message": "Vihara created successfully.",
  "data": {
    "vh_id": 123,
    "vh_trn": "TRN0000123",
    "vh_vname": "Sri Dharmarama Viharaya",
    "vh_email": "dharmarama@temple.lk",
    "vh_workflow_status": "PENDING",
    "resident_bhikkhus": [
      {
        "id": 1,
        "vh_id": 123,
        "serialNumber": 1,
        "bhikkhuName": "Ven. Dharmasena Thero",
        "registrationNumber": "BH2025000001",
        "occupationEducation": "Chief Monk, Viharadhipathi, BA in Buddhist Studies, Dhamma Teacher"
      },
      {
        "id": 2,
        "vh_id": 123,
        "serialNumber": 2,
        "bhikkhuName": "Ven. Sumana Thero",
        "registrationNumber": "BH2025000002",
        "occupationEducation": "Assistant Monk, Sunday School Teacher, Diploma in Pali"
      },
      {
        "id": 3,
        "vh_id": 123,
        "serialNumber": 3,
        "bhikkhuName": "Ven. Ananda Thero",
        "registrationNumber": "BH2025000003",
        "occupationEducation": "Novice Monk, Student of Buddhist Philosophy"
      }
    ],
    "temple_lands": [
      {
        "id": 1,
        "vh_id": 123,
        "serialNumber": 1,
        "landName": "Main Temple Land",
        "village": "Gampaha Town",
        "district": "Gampaha",
        "extent": "2 acres 1 rood 15 perches"
        // ... other fields
      }
    ]
    // ... other fields
  }
}
```

---

## Error Responses

### Validation Error
**Status Code:** `422 Unprocessable Entity`

```json
{
  "detail": [
    {
      "loc": ["body", "payload", "data", "telephone_number"],
      "msg": "Phone numbers must be exactly 10 digits.",
      "type": "value_error"
    }
  ]
}
```

### Duplicate Email/Phone
**Status Code:** `422 Unprocessable Entity`

```json
{
  "detail": [
    {
      "loc": null,
      "msg": "vh_email 'temple@example.com' is already registered.",
      "type": "value_error"
    }
  ]
}
```

### Authentication Error
**Status Code:** `401 Unauthorized`

```json
{
  "detail": "Not authenticated"
}
```

---

## Important Notes for Frontend Developers

### 1. Field Naming Convention
- **Frontend uses:** `camelCase` (e.g., `bhikkhuName`)
- **Backend uses:** `snake_case` (e.g., `bhikkhu_name`)
- The API automatically converts between formats ✅

### 2. Required Fields
Minimum required fields to create a vihara:
- `telephone_number` (10 digits)
- `whatsapp_number` (10 digits)
- `email_address` (valid email)
- `grama_niladhari_division` (GN code)
- `parshawaya` (Parshawa code)

### 3. Phone Number Validation
- Must be **exactly 10 digits**
- Examples: `"0771234567"`, `"0112345678"`
- ❌ Invalid: `"077-123-4567"`, `"77123456"`, `"077 123 4567"`

### 4. Email Validation
- Must be unique in the system
- Must be valid email format

### 5. Array Fields (temple_owned_land & resident_bhikkhus)
- Can be empty arrays `[]`
- `serialNumber` must start from 1 and increment sequentially
- Do NOT send `id` field when creating (auto-generated)
- `id` field will be returned in the response

### 6. Boolean Fields
- Send as JSON boolean: `true` or `false`
- Not as strings: ❌ `"true"` or `"false"`

### 7. Optional vs Required
- Most fields are optional except those marked as **Required**
- Send `null` or omit optional fields if no value

### 8. Workflow Status
- New viharas start with status: `"PENDING"`
- Status flow: `PENDING` → `PRINTED` → `PEND-APPROVAL` → `COMPLETED`/`REJECTED`

---

## Testing

### Test File Available
Complete test payload is available in:
```
vihara_create_complete_payload.json
```

### Quick Test
```bash
curl -X POST "http://localhost:8000/api/v1/vihara-data/manage" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d @vihara_create_complete_payload.json
```

---

## Questions?

If you have any questions about the API, please contact the backend team or refer to:
- `VIHARA_RESIDENT_BHIKKHUS_IMPLEMENTATION.md` - Technical implementation details
- `test_vihara_workflow.sh` - Complete workflow test script

---

**Last Updated:** December 8, 2025  
**API Version:** v1  
**Feature:** Resident Bhikkhus support added ⭐
